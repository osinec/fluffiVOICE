<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluffi Bird - –£–ø—Ä–∞–≤–ª—è–π –≥–æ–ª–æ—Å–æ–º!</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        :root {
            --sky-blue: #87CEEB;
            --light-sky: #E0F7FA;
            --gold: #FFD700;
            --dark-gold: #FFC600;
            --orange: #FF8C00;
            --red: #FF6347;
            --green: #2E8B57;
            --light-green: #228B22;
            --white: #FFFFFF;
            --black: #333333;
            --shadow: rgba(0, 0, 0, 0.2);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--sky-blue), var(--light-sky));
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            color: var(--black);
            padding-bottom: 100px; /* –ú–µ—Å—Ç–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ */
        }
        #game-container {
            position: relative;
            width: 400px;
            height: 600px;
            background: linear-gradient(to bottom, #7FB2E9, #A9D4F5);
            border: 4px solid var(--black);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow);
        }
        #bird {
            position: absolute;
            width: 50px;
            height: 40px;
            background-color: var(--gold);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            left: 80px;
            top: 300px;
            z-index: 10;
            transition: transform 0.1s ease-out;
            box-shadow: 3px 3px 6px var(--shadow);
        }
        #bird:before {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--red);
            border-radius: 50%;
            top: 8px;
            right: 8px;
            border: 2px solid var(--white);
        }
        #bird:after {
            content: '';
            position: absolute;
            width: 20px;
            height: 10px;
            background-color: var(--orange);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            bottom: -4px;
            right: -6px;
            transform: rotate(-30deg);
        }
        .eye {
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: var(--black);
            border-radius: 50%;
            top: 10px;
            right: 10px;
        }
        .wing {
            position: absolute;
            width: 30px;
            height: 15px;
            background-color: var(--dark-gold);
            border-radius: 50%;
            top: 15px;
            left: -10px;
            transform-origin: right center;
            animation: flap 0.3s infinite alternate;
        }
        @keyframes flap {
            0% { transform: rotate(-10deg); }
            100% { transform: rotate(30deg); }
        }
        .pipe {
            position: absolute;
            width: 70px;
            background: linear-gradient(to right, var(--green), var(--light-green));
            border: 3px solid var(--black);
            border-radius: 8px;
            right: -70px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            transition: right 0.05s linear;
        }
        .pipe-top {
            top: 0;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
        }
        .pipe-bottom {
            bottom: 0;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }
        .pipe-top:after, .pipe-bottom:after {
            content: '';
            position: absolute;
            width: 80px;
            height: 30px;
            background: linear-gradient(to right, var(--green), var(--light-green));
            border: 3px solid var(--black);
            border-top: none;
            left: -5px;
        }
        .pipe-top:after {
            bottom: -30px;
            border-radius: 0 0 8px 8px;
        }
        .pipe-bottom:after {
            top: -30px;
            border-radius: 8px 8px 0 0;
            border-bottom: none;
        }
        #score {
            position: absolute;
            top: 30px;
            left: 30px;
            font-size: 28px;
            font-weight: bold;
            color: var(--white);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        #start-screen, #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7);
            color: var(--white);
            z-index: 200;
            text-align: center;
            padding: 20px;
            transition: all 0.3s ease;
        }
        #game-over {
            display: none;
            background-color: rgba(0, 0, 0, 0.8);
        }
        h1 {
            font-size: 36px;
            margin-bottom: 20px;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        p {
            font-size: 18px;
            margin-bottom: 10px;
            max-width: 80%;
        }
        button {
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            background-color: var(--gold);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 30px;
            color: var(--black);
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background-color: var(--dark-gold);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        button:active {
            transform: translateY(1px);
        }
        #mic-status {
            position: absolute;
            bottom: 30px;
            left: 30px;
            color: var(--white);
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            background-color: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 20px;
        }
        #volume-container {
            position: absolute;
            bottom: 70px;
            left: 30px;
            width: 200px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #volume-meter {
            width: 100%;
            height: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        #volume-level {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.1s;
        }
        #volume-label {
            color: var(--white);
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        .cloud {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            filter: blur(5px);
            z-index: 1;
        }
        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, #8B4513, #A0522D);
            border-top: 3px solid var(--black);
            z-index: 5;
        }
        #instructions {
            position: absolute;
            bottom: 120px;
            left: 0;
            width: 100%;
            text-align: center;
            color: var(--white);
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            opacity: 0.8;
        }
        /* –ö–Ω–æ–ø–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ ‚Äî —Ç–µ–ø–µ—Ä—å –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –Ω–∏–∂–µ */
        #mic-permission-btn {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            display: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            background-color: #FF5722;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            max-width: 80%;
            width: auto;
        }
    </style>
</head>
<body>
    <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="game-container">
        <div id="score">0</div>
        <div id="bird">
            <div class="eye"></div>
            <div class="wing"></div>
        </div>
        <div id="ground"></div>
        <div id="volume-container">
            <div id="volume-meter">
                <div id="volume-level"></div>
            </div>
            <div id="volume-label">–ì–†–û–ú–ö–û–°–¢–¨</div>
        </div>
        <div id="mic-status">üé§ –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É" –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</div>
        <div id="instructions">–ì–æ–≤–æ—Ä–∏—Ç–µ –≥—Ä–æ–º—á–µ —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å—Å—è, —Ç–∏—à–µ - —á—Ç–æ–±—ã –æ–ø—É—Å—Ç–∏—Ç—å—Å—è</div>
        <div id="start-screen">
            <h1>Fluffi Bird</h1>
            <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ç–∏—á–∫–æ–π —Å –ø–æ–º–æ—â—å—é —Å–≤–æ–µ–≥–æ –≥–æ–ª–æ—Å–∞!</p>
            <p>–ß–µ–º –≥—Ä–æ–º—á–µ –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ, —Ç–µ–º –≤—ã—à–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ç–∏—á–∫–∞.</p>
            <p>–ü—Ä–æ–ª–µ—Ç–∞–π—Ç–µ –º–µ–∂–¥—É —Ç—Ä—É–±–∞–º–∏ –∏ –Ω–∞–±–∏—Ä–∞–π—Ç–µ –æ—á–∫–∏!</p>
            <button id="start-btn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        </div>
        <div id="game-over">
            <h1>–ò–≥—Ä–∞ –û–∫–æ–Ω—á–µ–Ω–∞!</h1>
            <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</p>
            <p id="final-score" style="font-size: 48px; color: var(--gold); margin: 10px 0;">0</p>
            <button id="restart-btn">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É ‚Äî –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
    <button id="mic-permission-btn">–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</button>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–≥—Ä—ã
        const bird = document.getElementById('bird');
        const gameContainer = document.getElementById('game-container');
        const scoreElement = document.getElementById('score');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreElement = document.getElementById('final-score');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const micStatus = document.getElementById('mic-status');
        const volumeLevel = document.getElementById('volume-level');
        const volumeLabel = document.getElementById('volume-label');
        const micPermissionBtn = document.getElementById('mic-permission-btn');

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const GAME_WIDTH = 400;
        const GAME_HEIGHT = 600;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let gameRunning = false;
        let score = 0;
        let birdPosition = 300;
        let birdVelocity = 0;
        let pipes = [];
        let pipeTimer;
        let animationFrame;
        let audioContext;
        let analyser;
        let microphone;
        let isMicActive = false;
        let smoothVolume = 0;
        let clouds = [];
        let awaitingMicPermission = false;

        // ============ ‚öôÔ∏è –ù–ê–°–¢–†–ê–ò–í–ê–ï–ú–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ ============

        // 1. –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è ‚Äî —Å–∏–ª–∞ –ø–∞–¥–µ–Ω–∏—è –ø—Ç–∏—á–∫–∏ (—á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –ø–∞–¥–∞–µ—Ç)
        const GRAVITY = 0.6;

        // 2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø—Ç–∏—á–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è
        const MIN_VOLUME = 0.2; // –Ω–∏–∂–µ ‚Äî –ø—Ç–∏—á–∫–∞ –ø–∞–¥–∞–µ—Ç

        // 3. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (–≤—ã—à–µ ‚Äî –ø—Ç–∏—á–∫–∞ –Ω–µ –≤–∑–ª–µ—Ç–∏—Ç)
        const MAX_VOLUME = 0.4;

        // 4. –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ –ø—Ç–∏—á–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –≥–æ–ª–æ—Å
        const SENSITIVITY = 80;// –ø–æ–ø—Ä–æ–±—É–π 8‚Äì16

        // 5. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–ª–∞–∫–æ–≤ –Ω–∞ —Ñ–æ–Ω–µ
        const CLOUD_COUNT = 5;

        // 6. –°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è —Ç—Ä—É–± (px –∑–∞ –∫–∞–¥—Ä)
        const PIPE_SPEED = 3;

        // 7. –í—ã—Å–æ—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Ç—Ä—É–±–∞–º–∏ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö)
        const PIPE_GAP = 200;

        // =================================================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–ª–∞–∫–æ–≤
        function initClouds() {
            for (let i = 0; i < CLOUD_COUNT; i++) {
                createCloud();
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±–ª–∞–∫–∞
        function createCloud() {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            const size = Math.random() * 50 + 50;
            const posX = Math.random() * GAME_WIDTH;
            const posY = Math.random() * (GAME_HEIGHT - 200);
            const opacity = Math.random() * 0.5 + 0.3;
            const speed = Math.random() * 0.5 + 0.2;
            cloud.style.width = `${size}px`;
            cloud.style.height = `${size * 0.6}px`;
            cloud.style.left = `${posX}px`;
            cloud.style.top = `${posY}px`;
            cloud.style.opacity = opacity;
            gameContainer.appendChild(cloud);
            clouds.push({
                element: cloud,
                speed: speed,
                x: posX
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –æ–±–ª–∞–∫–æ–≤
        function updateClouds() {
            for (let i = clouds.length - 1; i >= 0; i--) {
                const cloud = clouds[i];
                cloud.x -= cloud.speed;
                if (cloud.x < -100) {
                    cloud.x = GAME_WIDTH + 50;
                    cloud.element.style.top = `${Math.random() * (GAME_HEIGHT - 200)}px`;
                }
                cloud.element.style.left = `${cloud.x}px`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        async function initMicrophone() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 256;
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                isMicActive = true;
                micStatus.innerHTML = "üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω: <span style='color: #4CAF50'>–∞–∫—Ç–∏–≤–µ–Ω</span>";
                volumeLabel.style.color = "#4CAF50";
                return true;
            } catch (error) {
                console.error("Error accessing microphone:", error);
                micStatus.innerHTML = "üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω: <span style='color: #FF6347'>–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>";
                volumeLabel.style.color = "#FF6347";
                return false;
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function getVolume() {
            if (!analyser) return 0;
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(dataArray);
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = sum / dataArray.length;
            let normalized = Math.min(average / 255, 1);
            smoothVolume = smoothVolume * 0.3 + normalized * 0.7;
            const targetWidth = smoothVolume * 100;
            const currentWidth = parseFloat(volumeLevel.style.width) || 0;
            volumeLevel.style.width = `${currentWidth + (targetWidth - currentWidth) * 0.2}%`;
            return smoothVolume;
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            if (!gameRunning) {
                gameRunning = true;
                score = 0;
                birdPosition = 300;
                birdVelocity = 0;
                pipes = [];
                scoreElement.textContent = "0";
                startScreen.style.display = "none";
                gameOverScreen.style.display = "none";
                bird.style.top = birdPosition + "px";
                bird.style.transform = "rotate(0deg)";
                document.querySelectorAll('.pipe').forEach(pipe => pipe.remove());
                initClouds();
                awaitingMicPermission = true;
                micPermissionBtn.style.display = "block";
                micPermissionBtn.textContent = "–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É";
                micStatus.innerHTML = "üé§ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω";
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
        async function handleMicPermission() {
            try {
                micPermissionBtn.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
                const success = await initMicrophone();
                if (success) {
                    micPermissionBtn.style.display = "none";
                    awaitingMicPermission = false;
                    pipeTimer = setInterval(generatePipe, 1800);
                    gameLoop();
                } else {
                    micPermissionBtn.textContent = "–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò–≥—Ä–∞ –Ω–∞ –∫–ª–∞–≤–∏—à–∏";
                    pipeTimer = setInterval(generatePipe, 1800);
                    gameLoop();
                }
            } catch (error) {
                console.error("Error:", error);
                micPermissionBtn.textContent = "–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞";
            }
        }

        // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
        function gameOver() {
            gameRunning = false;
            clearInterval(pipeTimer);
            cancelAnimationFrame(animationFrame);
            finalScoreElement.textContent = score;
            gameOverScreen.style.display = "flex";
            finalScoreElement.style.transform = "scale(1.2)";
            setTimeout(() => {
                finalScoreElement.style.transform = "scale(1)";
            }, 300);
            if (microphone) {
                microphone.disconnect();
                isMicActive = false;
                micStatus.innerHTML = "üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω: <span style='color: #FF6347'>–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω</span>";
                volumeLabel.style.color = "#FF6347";
            }
            micPermissionBtn.style.display = "none";
            awaitingMicPermission = false;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä—É–±
        function generatePipe() {
            if (!gameRunning) return;
            const gapPosition = Math.floor(Math.random() * (600 - PIPE_GAP - 250)) + 100;
            const topPipe = document.createElement('div');
            topPipe.className = 'pipe pipe-top';
            topPipe.style.height = gapPosition + "px";
            gameContainer.appendChild(topPipe);
            const bottomPipe = document.createElement('div');
            bottomPipe.className = 'pipe pipe-bottom';
            bottomPipe.style.height = (600 - gapPosition - PIPE_GAP) + "px";
            gameContainer.appendChild(bottomPipe);
            pipes.push({
                topElement: topPipe,
                bottomElement: bottomPipe,
                x: 400,
                topHeight: gapPosition,
                bottomHeight: 600 - gapPosition - PIPE_GAP,
                passed: false
            });
        }

        // –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            if (!gameRunning) return;

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–º
            if (isMicActive) {
                const rawVolume = getVolume();
                const clampedVolume = Math.max(MIN_VOLUME, Math.min(MAX_VOLUME, rawVolume));
                const normalizedVolume = (clampedVolume - MIN_VOLUME) / (MAX_VOLUME - MIN_VOLUME);
                birdVelocity = -normalizedVolume * SENSITIVITY;
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é
            birdVelocity += GRAVITY;
            birdPosition += birdVelocity;

            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ç–∏—á–∫–∏
            if (birdPosition <= 0 || birdPosition >= 600 - 40) {
                gameOver();
                return;
            }

            bird.style.top = birdPosition + "px";
            const rotation = Math.max(-30, Math.min(30, birdVelocity * 3));
            bird.style.transform = `rotate(${rotation}deg)`;

            updateClouds();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä—É–±
            for (let i = pipes.length - 1; i >= 0; i--) {
                const pipe = pipes[i];
                pipe.x -= PIPE_SPEED;
                pipe.topElement.style.right = (400 - pipe.x - 70) + "px";
                pipe.bottomElement.style.right = (400 - pipe.x - 70) + "px";

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                if (
                    (80 + 50 > pipe.x && 80 < pipe.x + 70) &&
                    (birdPosition < pipe.topHeight || birdPosition + 40 > 600 - pipe.bottomHeight)
                ) {
                    bird.style.backgroundColor = '#FF6347';
                    setTimeout(() => {
                        if (gameRunning) bird.style.backgroundColor = '#FFD700';
                    }, 100);
                    gameOver();
                    return;
                }

                // –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç—Ä—É–±—ã
                if (!pipe.passed && pipe.x + 70 < 80) {
                    pipe.passed = true;
                    score++;
                    scoreElement.textContent = score;
                    scoreElement.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        scoreElement.style.transform = 'scale(1)';
                    }, 200);
                }

                // –£–¥–∞–ª–µ–Ω–∏–µ —É—à–µ–¥—à–∏—Ö —Ç—Ä—É–±
                if (pipe.x + 70 < 0) {
                    pipe.topElement.remove();
                    pipe.bottomElement.remove();
                    pipes.splice(i, 1);
                }
            }

            animationFrame = requestAnimationFrame(gameLoop);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);
        micPermissionBtn.addEventListener('click', handleMicPermission);

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (!gameRunning && e.code === 'Space') {
                startGame();
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
