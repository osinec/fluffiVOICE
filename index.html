<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì–æ–≤–æ—Ä–∏ ‚Äî –¥–∏–Ω–æ–∑–∞–≤—Ä –∏–¥—ë—Ç!</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: #c0c0c0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    #dino {
      width: 80px;
      height: 100px;
      background-image: url('https://raw.githubusercontent.com/GoogleChrome/chrome-dino/master/assets/images/dino.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      filter: grayscale(100%) contrast(0) brightness(0.5);
      position: absolute;
      bottom: 100px;
      left: 50px;
      transition: left 0.1s ease;
    }

    #status {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
      text-align: center;
    }

    #permission {
      margin-top: 20px;
      padding: 12px 24px;
      background: #000;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    #permission:hover {
      background: #333;
    }

    #ground {
      position: absolute;
      bottom: 80px;
      width: 100%;
      height: 2px;
      background: #000;
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <!-- –ü–æ–ª–æ—Ç–Ω–æ -->
  <div id="ground"></div>
  <div id="dino"></div>
  <div id="status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</div>
  <button id="permission">üîä –†–∞–∑—Ä–µ—à–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</button>

  <script>
    const dino = document.getElementById('dino');
    const statusText = document.getElementById('status');
    const permissionBtn = document.getElementById('permission');

    let dinoPosition = 50; // –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
    const maxPosition = window.innerWidth - 100; // –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞

    let audioContext = null;
    let analyser = null;
    let microphone = null;
    let dataArray = null;
    let isRunning = false;

    // –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    async function startMicrophone() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        setupAudio(stream);
        permissionBtn.style.display = 'none';
        statusText.textContent = '–ì–æ–≤–æ—Ä–∏—Ç–µ ‚Äî –¥–∏–Ω–æ–∑–∞–≤—Ä –ø–æ—à—ë–ª!';
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:', err);
        statusText.innerHTML = `
          –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.<br>
          <small>
            –£–±–µ–¥–∏—Ç–µ—Å—å:<br>
            1. –°–∞–π—Ç –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (–Ω–µ file://)<br>
            2. –†–∞–∑—Ä–µ—à—ë–Ω –º–∏–∫—Ä–æ—Ñ–æ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ<br>
            3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –∏–ª–∏ localhost
          </small>
        `;
        permissionBtn.disabled = true;
      }
    }

    function setupAudio(stream) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      microphone = audioContext.createMediaStreamSource(stream);
      microphone.connect(analyser);

      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);

      isRunning = true;
      update();
    }

    function update() {
      if (!isRunning) return;

      analyser.getByteFrequencyData(dataArray);

      // –°—Ä–µ–¥–Ω—è—è –≥—Ä–æ–º–∫–æ—Å—Ç—å
      const sum = dataArray.reduce((acc, val) => acc + val, 0);
      const average = sum / dataArray.length;

      // –ü–æ—Ä–æ–≥ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (–Ω–∞—Å—Ç—Ä–æ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
      const threshold = 55;

      if (average > threshold && dinoPosition < maxPosition) {
        dinoPosition += 12;
        dino.style.left = dinoPosition + 'px';
        statusText.textContent = 'üîä –ó–≤—É–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω! –î–∏–Ω–æ–∑–∞–≤—Ä –∏–¥—ë—Ç!';
      } else {
        statusText.textContent = 'üîá –¢–∏—à–∏–Ω–∞... –ñ–¥—É –∑–≤—É–∫.';
      }

      // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
      requestAnimationFrame(update);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    permissionBtn.addEventListener('click', startMicrophone);

    // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', () => {
      maxPosition = window.innerWidth - 100;
      if (dinoPosition > maxPosition) {
        dinoPosition = maxPosition;
        dino.style.left = dinoPosition + 'px';
      }
    });
  </script>
</body>
</html>
